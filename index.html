<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aurora Capture 极光捕网</title>
  <link rel="stylesheet" href="./style.css?v=0280" />
  <!-- SunCalc: 太阳/月亮高度（仅后台计算，不在前台露出） -->
  <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>
  <!-- Chart.js: 1小时 C值柱状图 -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="wrap">
    <header class="head">
      <div class="brandRow">
        <div class="brand">
          <div class="logo">
            <img src="./assets/logo-v2.png" alt="Aurora Capture logo">
          </div>
          <div class="titleBlock">
            <div class="titleRow">
              <h1>Aurora Capture <span class="cn">极光捕网</span></h1>
            </div>
          </div>
        </div>
      </div>
    </header>

    <section class="card topCard">
      <div class="grid2">
        <label class="field">
          <span class="label">纬度 Latitude</span>
          <input id="lat" type="number" step="0.0001" placeholder="例如 53.47" />
        </label>
        <label class="field">
          <span class="label">经度 Longitude</span>
          <input id="lon" type="number" step="0.0001" placeholder="例如 122.35" />
        </label>
      </div>

      <div class="row actions">
        <button id="btnRun" type="button" class="btn primary">生成即时预测</button>
        <button id="btnAbout" type="button" class="btn ghost">工具介绍</button>
        <div class="hint">提示：经纬度可在 Google/Apple/高德地图“位置详情”里复制。</div>
      </div>

      <details class="faq">
        <summary>如何查看经纬度？</summary>
        <div class="faqBody">
          在 Google / Apple / 高德地图里：长按你的位置 → 详情会显示“纬度、经度”。复制到这里即可。
        </div>
      </details>

      <div class="row statusRow">
        <div class="statusDots" id="statusDots"></div>
        <div class="statusText" id="statusText">等待生成。</div>
      </div>
    </section>

    <section class="tabs">
      <button class="tab active" data-tab="t1">1小时精准</button>
      <button class="tab" data-tab="t3">3小时观测窗口</button>
      <button class="tab" data-tab="t72">72小时范围</button>
    </section>

    <!-- 1小时 -->
    <section id="t1" class="pane active">
      <div class="oneHourStack">
      <!-- 上：结论条 -->
      <div class="card hero">
        <div class="k">当前建议（1小时内，10分钟粒度）</div>

        <!-- 保留原来的数据锚点，JS 才能填进去 -->
        <div class="big" id="oneHeroLabel">—</div>
        <div class="small" id="oneHeroMeta">—</div>

        <!-- 右侧解释预留区（可选） -->
        <div class="heroTopRow" style="margin-top:12px;">
          <div class="heroMain"></div>
          <div class="heroSide" id="oneBlockers"></div>
        </div>
      </div>

      <!-- 下：上游实况条 -->
      <div class="card hero swHeroWide">
        <div class="k">上游实况（近实时）</div>

        <!-- 保留原来的数据锚点 -->
        <div class="mono big2" id="swLine">V — ｜ Bt — ｜ Bz — ｜ N —</div>
        <div class="small" id="swMeta">—</div>
      </div>

      <!-- 中：C值柱状图 + 说明（与上方同宽） -->
      <div class="fullWidthStack">
        <div class="card chartCard">
          <div class="chartHead">
            <div>
              <div class="k">1小时 C值（Capture）柱状图</div>
              <div class="small">C值范围 1–5，越高越建议投入。</div>
            </div>
            <div class="pill">单位：10分钟</div>
          </div>
          <div class="chartWrap">
            <canvas id="cChart"></canvas>
          </div>
        </div>

        <div class="card explain">
          <div class="k">1小时预测结论分级（C值）</div>
          <ul class="bullets">
            <li><b>5分 强烈推荐</b>：投入回报高，建议立即行动。</li>
            <li><b>4分 值得出门</b>：条件不错，建议准备与试拍。</li>
            <li><b>3分 可蹲守</b>：存在机会，建议架机等待触发。</li>
            <li><b>2分 低概率</b>：机会小，可低成本尝试。</li>
            <li><b>1分 不可观测</b>：当前时段不建议投入。</li>
          </ul>
        </div>
      </div>
      </div>
    </section>

    <!-- 3小时 -->
    <section id="t3" class="pane">
      <div class="gridCards">
        <div class="card hero">
          <div class="k">3小时观测窗口（逐小时）</div>
          <div class="big" id="threeState">—</div>
          <div class="burstLine" id="threeBurst">—</div>
          <div class="threeSlots" id="threeHint">—</div>
        </div>

        <div class="card hero">
          <div class="k">太阳风送达能力综合模型</div>
          <div class="big2" id="threeDeliver">—</div>
          <div class="small" id="threeDeliverMeta">—</div>
        </div>

        <!-- 云量模块（默认隐藏，作为高级信息/退路保留）
        <div class="card hero">
          <div class="k">云量条件（未来3小时）</div>
          <div class="mono big2" id="threeClouds">—</div>
          <div class="small" id="threeCloudHint">评分基于本地纬度的“更适合拍摄的云量范围”。</div>
        </div>
        -->
      </div>

      <div class="card explain">
        <div class="k">3小时结论分级（C值）</div>
        <ul class="bullets">
          <li><b>5分 强烈推荐</b>：投入回报高，建议立即行动。</li>
          <li><b>4分 值得出门</b>：条件不错，建议准备与试拍。</li>
          <li><b>3分 可蹲守</b>：存在机会，建议架机等待触发。</li>
          <li><b>2分 低概率</b>：机会小，可低成本尝试。</li>
          <li><b>1分 不可观测</b>：当前时段不建议投入。</li>
        </ul>
      </div>
    </section>

    <!-- 72小时 -->
    <section id="t72" class="pane">
      <div class="card">
        <div class="k">72小时范围预测</div>
        <div class="small">按天预测“可能性区间”，无法细致到具体时刻。</div>

        <!-- 72h 三列日卡：今天 / 明天 / 后天（由 app.js 动态填充） -->
        <div class="daysTri" id="daysTri">
          <div class="dayCard" id="day0">
            <div class="dayHead">
              <div class="dayLabel">今天</div>
              <div class="dayDate" id="day0Date">—</div>
            </div>
            <div class="dayConclusion" id="day0Conclusion">—</div>
            <div class="dayBasis" id="day0Basis">等待生成。</div>
          </div>

          <div class="dayCard" id="day1">
            <div class="dayHead">
              <div class="dayLabel">明天</div>
              <div class="dayDate" id="day1Date">—</div>
            </div>
            <div class="dayConclusion" id="day1Conclusion">—</div>
            <div class="dayBasis" id="day1Basis">等待生成。</div>
          </div>

          <div class="dayCard" id="day2">
            <div class="dayHead">
              <div class="dayLabel">后天</div>
              <div class="dayDate" id="day2Date">—</div>
            </div>
            <div class="dayConclusion" id="day2Conclusion">—</div>
            <div class="dayBasis" id="day2Basis">等待生成。</div>
          </div>
        </div>
      </div>

      <div class="card explain">
        <div class="k">72小时结论分级（C值）</div>
        <ul class="bullets">
          <li><b>5分 强烈推荐</b>：能量背景+送达能力更强，值得提前规划。</li>
          <li><b>4分 值得出门</b>：存在机会，重点看云与当晚即时模块。</li>
          <li><b>3分 可蹲守</b>：机会少，除非位置/条件极佳。</li>
          <li><b>2分 低概率</b>：综合偏弱，提前投入意义不大。</li>
          <li><b>1分 不可观测</b>：不建议投入。</li>
        </ul>
      </div>
    </section>

    <footer class="foot">
      数据源：NOAA SWPC（实时太阳风、OVATION nowcast、Kp 预报）与 Open-Meteo 云量预报。磁纬（MLAT）由 AACGMv2驱动，并已进行实时换算。
      <br>版本：v3.0.0280
    </footer>
  </div>

  <!-- 背景介绍 Modal -->
  <div id="aboutModal" class="modal hidden" aria-hidden="true">
    <div class="modalMask" data-close="1"></div>
    <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="aboutTitle">
      <div class="modalHead">
        <div id="aboutTitle" class="modalTitle">极光预测，为什么不能只是 KP？</div>
        <button id="btnAboutClose" class="btn icon" type="button" aria-label="关闭">✕</button>
      </div>
      <div class="modalBody">
        <p>
        KP 是为全球空间天气监测而设计的宏观指标。<br>
        它在航天器运行、电力系统防护、长期磁扰评估中非常有效，但它的设计目标，从来不是服务于具体地点、具体时段的地面观测者。
        </p>
        <p>
        对于普通极光观测与拍摄来说，KP 的粒度过于粗糙。<br>
        它不区分 IMF 的瞬时方向变化，也难以反映短时稳定性与局地响应。<br>
        这也是为什么在真实体验中，常常会出现：KP 看似“非常合适”，却完全无法观测或拍摄的情况。
        </p>
        <p>
        于是，在漠河零下40度的寒夜中，Aurora Capture 诞生了。
        </p>
        <p>
        C 值并不是用来替代 KP 的，<br>
        它更像是一个面向摄影师与追光者的【可拍可观指数】。
        </p>
        <p>
        作为一名理工科出身的风光摄影爱好者，我尝试从更接近观测者的角度出发，直接调用太阳风与磁场的原始参数建模。<br>
        在更短的时间尺度上，评估它们是否正在形成一个对拍摄友好的窗口。
        </p>
        <p>
        让我们一起来看看：<br>
        此刻，地球手里握着的，究竟是一副什么样的牌？
        </p>
        <p style="margin-top:18px; text-align:right; color:rgba(255,255,255,.55); font-size:12px;">
        —— @小狮子佑酱
        </p>
      </div>
    </div>
  </div>

  <!-- NOAA 强提示弹窗（数据缺失时弹出，必须手动关闭） -->
  <div class="alertOverlay" id="alertOverlay" aria-hidden="true">
    <div class="alertCard" role="dialog" aria-modal="true" aria-labelledby="alertTitle">
      <div class="alertHead">
        <div class="alertTitle" id="alertTitle">⚠️ 数据可信度提醒</div>
        <button class="modalX" id="alertClose" aria-label="关闭">✕</button>
      </div>
      <div class="alertBody" id="alertBody">—</div>
      <div class="alertNote" id="alertNote">不代表无法观测，仅表示模型输入存在不确定性。</div>
      <div class="alertFoot">
        <button class="btn primary" id="alertOk" type="button">知道了</button>
      </div>
    </div>
  </div>
  
  <!-- your modules -->
  <script defer src="./adapter.js?v=0280"></script>
  <script defer src="./ui.js?v=0280"></script>
  <script defer src="./model.js?v=0280"></script>
  <script defer src="./app.js?v=0280"></script>
  
</body>
</html>
